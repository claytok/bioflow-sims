<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="../bioflowsim.png">
    <title>Lagrangian vs Eulerian: Following Red Blood Cells</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 1000px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        .animation-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .view-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .view-title {
            text-align: center;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
        }
        
        .lagrangian-title {
            background: #e74c3c;
            color: white;
        }
        
        .eulerian-title {
            background: #3498db;
            color: white;
        }
        
        canvas {
            width: 100%;
            height: 300px;
            border: 3px solid #ecf0f1;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-play {
            background: #27ae60;
            color: white;
        }
        
        .btn-pause {
            background: #e67e22;
            color: white;
        }
        
        .btn-reset {
            background: #95a5a6;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .explanation {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .explanation-box {
            padding: 20px;
            border-radius: 15px;
            color: white;
        }
        
        .lagrangian-explanation {
            background: #e74c3c;
        }
        
        .eulerian-explanation {
            background: #3498db;
        }
        
        .cute-emoji {
            font-size: 2em;
            display: block;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .blood-vessel {
            position: relative;
            height: 80px;
            background: linear-gradient(to bottom, #c0392b 0%, #c0392b 15%, transparent 15%, transparent 85%, #c0392b 85%, #c0392b 100%);
            border-radius: 40px;
            margin: 20px 0;
        }
        
        .flow-arrow {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: #2c3e50;
        }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
                margin-bottom: 20px;
            }
            
            .subtitle {
                font-size: 1em;
                margin-bottom: 20px;
            }
            
            .animation-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .view-container {
                padding: 15px;
            }
            
            .view-title {
                font-size: 1.2em;
                padding: 8px;
            }
            
            canvas {
                height: 250px;
            }
            
            .controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .explanation {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .explanation-box {
                padding: 15px;
            }
            
            .explanation-box h3 {
                font-size: 1.2em;
            }
            
            .explanation-box ul {
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .subtitle {
                font-size: 0.9em;
            }
            
            canvas {
                height: 200px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 13px;
            }
            
            .explanation-box {
                padding: 12px;
            }
            
            .explanation-box h3 {
                font-size: 1.1em;
            }
            
            .explanation-box ul {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü©∏ Lagrangian vs Eulerian Perspectives</h1>
        <div class="subtitle">Following Red Blood Cells Through Your Cardiovascular System</div>
        
        <div class="blood-vessel">
            <div class="flow-arrow">‚Üí Blood Flow ‚Üí</div>
        </div>
        
        <div class="animation-container">
            <div class="view-container">
                <div class="view-title lagrangian-title">
                    <span class="cute-emoji">üî¥</span>
                    Lagrangian View: "Follow the Red Blood Cell!"
                </div>
                <canvas id="lagrangianCanvas" width="400" height="300"></canvas>
            </div>
            
            <div class="view-container">
                <div class="view-title eulerian-title">
                    <span class="cute-emoji">üìç</span>
                    Eulerian View: "Watch from a Fixed Spot!"
                </div>
                <canvas id="eulerianCanvas" width="400" height="300"></canvas>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-play" onclick="startAnimation()">‚ñ∂Ô∏è Start Journey</button>
            <button class="btn btn-pause" onclick="pauseAnimation()">‚è∏Ô∏è Pause</button>
            <button class="btn btn-reset" onclick="resetAnimation()">üîÑ Reset</button>
        </div>
        
        <div class="explanation">
            <div class="explanation-box lagrangian-explanation">
                <div class="cute-emoji">üéØ</div>
                <h3>Lagrangian Perspective</h3>
                <p><strong>"I'm following one specific red blood cell!"</strong></p>
                <ul>
                    <li>Track individual particle paths</li>
                    <li>Perfect for drug delivery studies</li>
                    <li>Answers: "Where will this cell go?"</li>
                    <li>Math: x‚Éó(t), v‚Éó(t), a‚Éó(t)</li>
                </ul>
                <p><em>Like being a GPS tracker attached to a red blood cell! üõ∞Ô∏è</em></p>
            </div>
            
            <div class="explanation-box eulerian-explanation">
                <div class="cute-emoji">üè•</div>
                <h3>Eulerian Perspective</h3>
                <p><strong>"I'm a doctor with an ultrasound probe!"</strong></p>
                <ul>
                    <li>Measure properties at fixed locations</li>
                    <li>Perfect for clinical measurements</li>
                    <li>Answers: "What's the flow rate here?"</li>
                    <li>Math: v‚Éó(x‚Éó,t), P(x‚Éó,t)</li>
                </ul>
                <p><em>Like a traffic camera watching cars go by! üìπ</em></p>
            </div>
        </div>
    </div>

    <script>
        const lagrangianCanvas = document.getElementById('lagrangianCanvas');
        const eulerianCanvas = document.getElementById('eulerianCanvas');
        const lagCtx = lagrangianCanvas.getContext('2d');
        const eulCtx = eulerianCanvas.getContext('2d');
        
        let animationId;
        let isRunning = false;
        let time = 0;
        
        // Red blood cell that we're following (Lagrangian)
        let trackedCell = {
            x: 50,
            y: 150,
            vx: 2,
            vy: 0,
            trail: []
        };
        
        // Multiple cells for Eulerian view
        let cells = [];
        
        // Initialize cells for Eulerian view
        function initializeCells() {
            cells = [];
            for (let i = 0; i < 20; i++) {
                cells.push({
                    x: Math.random() * 500 - 100, // Some start off-screen
                    y: 120 + Math.random() * 60, // In the vessel
                    vx: 1.5 + Math.random() * 1,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: 4 + Math.random() * 3,
                    hue: Math.random() * 30 // Slight color variation
                });
            }
        }
        
        function drawBloodVessel(ctx) {
            // Draw vessel walls
            ctx.fillStyle = '#c0392b';
            ctx.fillRect(0, 100, ctx.canvas.width, 15); // Top wall
            ctx.fillRect(0, 185, ctx.canvas.width, 15); // Bottom wall
            
            // Draw vessel lumen
            ctx.fillStyle = 'rgba(231, 76, 60, 0.1)';
            ctx.fillRect(0, 115, ctx.canvas.width, 70);
        }
        
        function drawLagrangianView() {
            lagCtx.clearRect(0, 0, lagrangianCanvas.width, lagrangianCanvas.height);
            
            drawBloodVessel(lagCtx);
            
            // Update tracked cell position
            trackedCell.x += trackedCell.vx;
            trackedCell.y += Math.sin(time * 0.05) * 0.3; // Slight oscillation
            
            // Add to trail
            trackedCell.trail.push({x: trackedCell.x, y: trackedCell.y});
            if (trackedCell.trail.length > 100) {
                trackedCell.trail.shift();
            }
            
            // Reset if cell goes off screen
            if (trackedCell.x > lagrangianCanvas.width + 20) {
                trackedCell.x = -20;
                trackedCell.trail = [];
            }
            
            // Draw trail
            lagCtx.strokeStyle = 'rgba(231, 76, 60, 0.6)';
            lagCtx.lineWidth = 3;
            lagCtx.beginPath();
            for (let i = 0; i < trackedCell.trail.length; i++) {
                const point = trackedCell.trail[i];
                const alpha = i / trackedCell.trail.length;
                lagCtx.globalAlpha = alpha;
                
                if (i === 0) {
                    lagCtx.moveTo(point.x, point.y);
                } else {
                    lagCtx.lineTo(point.x, point.y);
                }
            }
            lagCtx.stroke();
            lagCtx.globalAlpha = 1;
            
            // Draw the special tracked cell
            lagCtx.fillStyle = '#e74c3c';
            lagCtx.strokeStyle = '#c0392b';
            lagCtx.lineWidth = 2;
            
            lagCtx.beginPath();
            lagCtx.arc(trackedCell.x, trackedCell.y, 8, 0, 2 * Math.PI);
            lagCtx.fill();
            lagCtx.stroke();
            
            // Add cute face to the tracked cell
            lagCtx.fillStyle = 'white';
            lagCtx.beginPath();
            lagCtx.arc(trackedCell.x - 2, trackedCell.y - 2, 1.5, 0, 2 * Math.PI);
            lagCtx.fill();
            lagCtx.beginPath();
            lagCtx.arc(trackedCell.x + 2, trackedCell.y - 2, 1.5, 0, 2 * Math.PI);
            lagCtx.fill();
            
            // Arrow showing direction
            lagCtx.strokeStyle = '#2c3e50';
            lagCtx.lineWidth = 2;
            lagCtx.beginPath();
            lagCtx.moveTo(trackedCell.x + 15, trackedCell.y);
            lagCtx.lineTo(trackedCell.x + 25, trackedCell.y);
            lagCtx.moveTo(trackedCell.x + 22, trackedCell.y - 3);
            lagCtx.lineTo(trackedCell.x + 25, trackedCell.y);
            lagCtx.lineTo(trackedCell.x + 22, trackedCell.y + 3);
            lagCtx.stroke();
            
            // Label
            lagCtx.fillStyle = '#2c3e50';
            lagCtx.font = 'bold 14px Arial';
            lagCtx.fillText('Following this cell!', 20, 50);
            lagCtx.fillText(`Position: (${Math.round(trackedCell.x)}, ${Math.round(trackedCell.y)})`, 20, 70);
        }
        
        function drawEulerianView() {
            eulCtx.clearRect(0, 0, eulerianCanvas.width, eulerianCanvas.height);
            
            drawBloodVessel(eulCtx);
            
            // Update all cells
            for (let cell of cells) {
                cell.x += cell.vx;
                cell.y += cell.vy + Math.sin(time * 0.03 + cell.x * 0.01) * 0.2;
                
                // Reset cells that go off screen
                if (cell.x > eulerianCanvas.width + 20) {
                    cell.x = -20;
                    cell.y = 120 + Math.random() * 60;
                }
                
                // Draw cell
                const hue = cell.hue;
                eulCtx.fillStyle = `hsl(${hue}, 70%, 50%)`;
                eulCtx.strokeStyle = `hsl(${hue}, 70%, 30%)`;
                eulCtx.lineWidth = 1;
                
                eulCtx.beginPath();
                eulCtx.arc(cell.x, cell.y, cell.size, 0, 2 * Math.PI);
                eulCtx.fill();
                eulCtx.stroke();
            }
            
            // Draw measurement point
            const measureX = 200;
            eulCtx.strokeStyle = '#3498db';
            eulCtx.lineWidth = 3;
            eulCtx.setLineDash([5, 5]);
            eulCtx.beginPath();
            eulCtx.moveTo(measureX, 100);
            eulCtx.lineTo(measureX, 200);
            eulCtx.stroke();
            eulCtx.setLineDash([]);
            
            // Count cells near measurement point
            let cellsNearPoint = 0;
            let avgVelocity = 0;
            for (let cell of cells) {
                if (Math.abs(cell.x - measureX) < 20) {
                    cellsNearPoint++;
                    avgVelocity += cell.vx;
                }
            }
            if (cellsNearPoint > 0) avgVelocity /= cellsNearPoint;
            
            // Labels
            eulCtx.fillStyle = '#2c3e50';
            eulCtx.font = 'bold 14px Arial';
            eulCtx.fillText('Measuring at fixed point', 20, 50);
            eulCtx.fillText(`Cells detected: ${cellsNearPoint}`, 20, 70);
            eulCtx.fillText(`Avg velocity: ${avgVelocity.toFixed(1)} units/s`, 20, 90);
            
            // Ultrasound probe
            eulCtx.fillStyle = '#34495e';
            eulCtx.fillRect(measureX - 5, 80, 10, 20);
            eulCtx.fillStyle = '#3498db';
            eulCtx.font = '12px Arial';
            eulCtx.fillText('üì°', measureX - 6, 75);
        }
        
        function animate() {
            if (isRunning) {
                time++;
                drawLagrangianView();
                drawEulerianView();
            }
            animationId = requestAnimationFrame(animate);
        }
        
        function startAnimation() {
            isRunning = true;
        }
        
        function pauseAnimation() {
            isRunning = false;
        }
        
        function resetAnimation() {
            isRunning = false;
            time = 0;
            trackedCell.x = 50;
            trackedCell.y = 150;
            trackedCell.trail = [];
            initializeCells();
            drawLagrangianView();
            drawEulerianView();
        }
        
        // Initialize
        initializeCells();
        resetAnimation();
        animate();
    </script>
</body>
</html> 